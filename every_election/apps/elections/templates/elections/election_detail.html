{% extends "base.html" %}
{% block page_title %}Election Summary{% endblock page_title %}

{% block content %}

    {% include "./election_summary.html" %}

    <div class="ds-card">
        <div class="ds-card-body">
            <h3>Related Elections</h3>
            {% if object.group or object.replaces or object.replaced_by %}
                <ul>
                    {% if object.group %}
                        <li>Part of the election group <a href="{{ object.group.get_absolute_url }}">{{ object.group }}</a></li>
                    {% endif %}
                    {% if object.replaces %}
                        <li>Replaces cancelled election <a href="{{ object.replaces.get_absolute_url }}">{{ object.replaces }}</a></li>
                    {% endif %}
                    {% if object.replaced_by %}
                        <li>This election was cancelled and replaced by <a href="{{ object.replaced_by.get_absolute_url }}">{{ object.replaced_by }}</a></li>
                    {% endif %}
                </ul>
            {% endif %}

            {% if object.children.all.exists %}
                <p>Sub-IDs for each election in this group:</p>
                <ul>
                    {% for child in object.children.all %}
                        <li>
                            <a href="{{ child.get_absolute_url }}">{{ child }}</a>
                            {% if child.cancelled %}
                                <span class="label alert">cancelled</span>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            {% if object.get_timetable %}
                <div class="ds-table">
                    <table>
                        <caption><h2>Timetable</h2></caption>
                        <thead>
                            <th>Event</th>
                            <th>Date</th>
                        </thead>
                        <tbody>
                            {% for row in object.get_timetable %}
                                <tr>
                                    <td>{{ row.label }}</td>
                                    <td>{{ row.date }}</td>
                                </tr>
                            {% endfor %}

                        </tbody>
                    </table>
                </div>
            {% endif %}

        {# Postal code lookup feature not yet implemented for Canadian version #}

            <h3>API</h3>
            <ul>
                <li><a href="{% url 'api:election-detail' election_id=object.election_id %}">
                    Election detail (JSON)
                </a>
                </li>
                {% if object.geography %}
                    <li><a href="{% url 'api:election-geo' election_id=object.election_id format='json' %}" rel="nofollow">
                        Election boundary (GeoJSON)
                    </a>
                    </li>
                {% endif %}
                {% if object.group_type is not None and request.user.is_authenticated %}
                    <li><a href="{% url 'ballots_csv_view' election_id=object.election_id %}">
                        All ballots in this group (CSV)
                    </a>
                    </li>
                {% endif %}
            </ul>

        {% if object.candidates_link or object.voter_info_link %}
            <h3>Additional Resources</h3>
            <ul>
                {% if object.candidates_link %}
                    <li><a href="{{ object.candidates_link }}">View candidates</a></li>
                {% endif %}
                {% if object.voter_info_link %}
                    <li><a href="{{ object.voter_info_link }}">Voter information</a></li>
                {% endif %}
            </ul>
        {% endif %}

        </div>
    </div>

{% endblock content %}

